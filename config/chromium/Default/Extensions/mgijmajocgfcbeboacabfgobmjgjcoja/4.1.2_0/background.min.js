/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var k="\" ' ( ) , - . / 0 1 2 : ? a about and are as be but com for from have i in is it like may more my next not of on search that the this to was when with you your".split(" "),p=!1,q={},r={},t=0,u=-1,v=-1,w="",x=function(a){a=a.replace(/<[^>]*>/g,"");return a=a.replace(/[<>]/g,"")},y=function(a){a=x(a);return a=a.substring(0,100).toLowerCase()},z=function(a){for(var c=0,b=k.length;c<b;c++)if(a===k[c])return!0;return!1},A=function(a,c,b){"initialize"===a.type&&b({instanceId:t++})},B=function(a){"openOptionsPage"===
a.type&&chrome.tabs.create({url:chrome.runtime.getURL("options.html")})},C=function(a,c,b){"options"===a.type&&b({options:q})},H=function(a,c,b){if("fetch_raw"!==a.type&&"fetch_html"!==a.type)return!1;_gaq&&_gaq.push(["_trackEvent","lookup",a.type]);-1!==u&&v!==a.instanceId&&chrome.tabs.sendMessage(u,{type:"hide",instanceId:v});"fetch_raw"===a.type?(u=c.tab.id,v=a.instanceId):v=u=-1;var d=y(a.query),f=function(){var e={request:a,sanitizedQuery:d,dictRes:null,enDictRes:null,tranRes:null,tabLangTranRes:null,
tabLangTranReqTimedOut:!1,tabLang:null,numResponses:0,callback:b,incognito:!1};E(d,q.language,function(m){e.dictRes=m;F(e)});"en"!==q.language?E(d,"en",function(m){e.enDictRes=m;F(e)}):F(e);G(d,"auto",function(m){e.tranRes=m;F(e)});chrome.tabs.getSelected(null,function(m){e.incognito=m.incognito;var g=window.setTimeout(function(){console.assert(null===e.tabLangTranRes);e.tabLangTranReqTimedOut=!0;F(e)},800);chrome.tabs.detectLanguage(m.id,function(h){e.tabLangTranReqTimedOut||(window.clearTimeout(g),
"und"!==h?(e.tabLang="he"===h?"iw":h,G(d,e.tabLang,function(n){e.tabLangTranRes=n;F(e)})):F(e))})})};if(p)f();else{var l=function(e){if(p)return f();if(10<e)return b({eventKey:a.eventKey,sanitizedQuery:d});window.setTimeout(function(){l(e+1)},200)};l(0)}return!0},E=function(a,c,b){var d=c;"en-uk"==c&&(d="en");var f=window["gdx.LANG_TO_CORPUS"][c];f||(f=c);a={path:w,params:{term:a,language:d,corpus:f}};(f=window["gdx.CORPUS_TO_COUNTRY"][f])&&(a.params.country=f);gapi.client.request(a).execute(function(l){var e=
l.status;if(e&&200!=e)b(null);else{l=I(l,"dictionaryData[0]");if(!l)return b(null);var m=function(g){if(!g.senseFamilies)return 0;g=g.senseFamilies;for(var h=g.length,n=0;n<g.length;n++)g[n].senses&&(h+=.1*g[n].senses.length);return h};e=function(g,h){return m(h)-m(g)};l.entries&&(l.entries=l.entries.sort(e));l.webDefinitions&&(l.hasWebDefinitions=!0);b(l)}})},G=function(a,c,b){a="https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl="+c+"&tl="+q.language+"&q="+encodeURIComponent(a);
var d=new XMLHttpRequest;d.open("GET",a,!0);d.onload=function(){var f=null;if(200===this.status)try{f=JSON.parse(d.response)}catch(l){}return b(f)};d.send()},F=function(a){a.numResponses++;if(4===a.numResponses){var c=J(a.dictRes),b=c;"en"!==q.language&&(b=J(a.enDictRes));var d=K(a.tranRes,!0),f=K(a.tabLangTranRes,!0),l=q.language.toLowerCase(),e=!1,m=null,g=null;f&&a.tabLang!==l?(e=!0,m=a.tabLangTranRes,g=f):!c&&d&&(e=!0,m=a.tranRes,g=d);e&&b&&b.audio&&"en"===g.srcLang.toLowerCase()&&(g.audio=b.audio);
b=e?"translation":"definition";c||g||(b="none");_gaq&&_gaq.push(["_trackEvent","lookup","type_"+b]);d=encodeURIComponent(a.sanitizedQuery);b="";e&&(b="https://translate.google.com/translate_t?source=dict-chrome-ex&sl="+g.srcLang+"&tl="+q.language+"&q="+d);d=L(d);if("fetch_html"===a.request.type)c="",c=e?M(m,g.audio,b):N(a.dictRes,d),e={eventKey:a.request.eventKey,sanitizedQuery:a.sanitizedQuery,html:c};else{var h=null,n=null;e?(h=g,h.moreUrl=b):c&&(h=c,h.moreUrl=d,h.srcLang=q.language);h&&"true"===
q.storeHistory&&!a.incognito&&chrome.storage.local.get("word-history",function(D){n=h.srcLang+"<"+q.language+"<"+a.sanitizedQuery;D["word-history"][n]=h.meaningText;chrome.storage.local.set(D)});h&&!h.prettyQuery&&(h.prettyQuery=a.sanitizedQuery);e=!1;("true"===q.popupDblclick&&"none"===q.popupDblclickKey||"true"===q.popupSelect&&"none"===q.popupSelectKey)&&z(a.sanitizedQuery)&&(e=!0);e={eventKey:a.request.eventKey,sanitizedQuery:a.sanitizedQuery,meaningObj:h,showOptionsTip:e}}a.callback(e)}},L=function(a){var c=
q.language,b=window["gdx.LANG_TO_DEFINE"][c].replace("${term}",a),d=window["gdx.LANG_TO_CORPUS"][q.language];d||(d=q.language);a="https://www.google.com/search?dictcorpus="+d+"&hl="+c+"&forcedict="+a+"&q="+b;"en-uk"===c&&(a+="&gl=gb");return a},K=function(a,c){if(!a||a.sentences[0].orig.toLowerCase()==a.sentences[0].trans.toLowerCase())return null;var b=a.sentences[0].orig.toLowerCase();var d=a.sentences[0].trans.toLowerCase(),f=d;if(c&&a.dict&&0<a.dict.length){c=0;for(var l=a.dict.length;c<l;c++)for(var e=
a.dict[c],m=0,g=0,h=e.terms.length;g<h&&2>m;g++){var n=e.terms[g].toLowerCase();0<n.length&&n!==b&&n!==d&&(f+=", "+n,m++)}}b=x(f);(d=window["gdx.LANG_TO_NAME"][a.src.toLowerCase()])||(d=a.src);return{type:"translation",meaningText:b,attribution:"Translated from "+d,srcLang:a.src}},I=function(a,c){c=c.split(".");for(var b=0;b<c.length;b++){var d=c[b];console.assert(d);if("]"===d.charAt(d.length-1)){d=d.split("[");console.assert(2===d.length);var f=parseInt(d[1].slice(0,-1),10);a=a[d[0]];if(!a)return null;
a=a[f]}else a=a[d];if(!a)return null}return a},O=function(a){return"//"===a.substr(0,2)?"https:"+a:a},J=function(a){if(!a||a.error)return null;var c,b=null;if(c=I(a,"entries[0]"))b={prettyQuery:c.syllabifiedHeadword||c.headword,meaningText:I(c,"senseFamilies[0].senses[0].definition.text"),attribution:"",audio:I(c,"phonetics[0].oxfordAudio"),type:"licensedDef"},b.meaningText?b.audio&&(b.audio=O(b.audio)):b=null;!b&&(c=I(a,"webDefinitions[0]"))&&(b=c.sourceUrl,b={meaningText:c.definition,attribution:'<a href="'+
b+'">'+b+"</a>",type:"webDef"});if(!b)return null;c=b.meaningText;b.meaningText=c.charAt(0).toUpperCase()+c.slice(1);return b},M=function(a,c,b){var d=K(a,!1);if(!d)return"";c&&(d.audio=c);a.tranResSummary=d;a.moreUrl=b;a.hasDict=!!a.dict&&a.dict.length;return r.browser_action_tran(a)},N=function(a,c){if(!a||a.error)return"";a.moreUrl=c;a.makeAudioUrl=function(){var d=this.oxfordAudio;return d?O(d):""};var b={};a.showOnlyOnce=function(){return function(d,f){d=f(d);if(b[d])return"";b[d]=!0;return d}};
return r.browser_action_dict(a)},P=function(a){var c={};c.language=a.language||"en";var b=function(f,l){var e=a[f];c[f]=l;"true"===e||"false"===e?c[f]=e:"boolean"===typeof e&&(c[f]=String(e))},d=function(f,l){c[f]=a[f]||l};b("popupDblclick","true");b("popupSelect","false");b("enableHttps","true");d("popupDblclickKey","none");d("popupSelectKey","ctrl");b("storeHistory","false");b("allowCrossExtensionHistory","false");"pt"===a.language&&(c.language="pt-BR");return c},Q=function(a,c,b){if("false"===
q.allowCrossExtensionHistory||"false"===q.storeHistory||!a||!a.getHistory)return!1;chrome.storage.local.get("word-history",function(d){b(d["word-history"])});return!0},R=function(a,c){var b=new XMLHttpRequest;b.open("GET",a,!0);b.onload=function(){var d=null;200===this.status&&(d=b.response);return c(d)};b.send()},S=function(){var a=window.localStorage.options,c={};a&&(c=JSON.parse(a));q=P(c);window.localStorage.options=JSON.stringify(q);chrome.storage.local.get("word-history",function(b){b["word-history"]||
chrome.storage.local.set({"word-history":{}})});chrome.runtime.onMessage.addListener(A);chrome.runtime.onMessage.addListener(B);chrome.runtime.onMessage.addListener(C);chrome.runtime.onMessage.addListener(H);chrome.runtime.onMessageExternal.addListener(Q)};window["gdx.updateOptions"]=function(){q=JSON.parse(window.localStorage.options)};
window.initBackgroundPageAsync=function(a){100>Math.floor(1E3*Math.random())?(gapi.config.update("googleapis.config/root","https://dictionaryextension-pa.googleapis.com"),gapi.client.setApiKey("AIzaSyA6EEtrDCfBkHV8uU2lgGY-N383ZgAOo7Y"),w="v1/dictionaryExtensionData"):(gapi.client.setApiKey("AIzaSyC9PDwo2wgENKuI8DSFOfqFqKP2cKAxxso"),w="dictionaryextension/v1/knowledge/search");var c=function(){2>Object.keys(r).length||(p=!0,a&&a())},b=function(d){Mustache.parse(d);return function(f){return Mustache.render(d,
f)}};R("templates/browser_action_dict.html",function(d){r.browser_action_dict=b(d);c()});R("templates/browser_action_tran.html",function(d){r.browser_action_tran=b(d);c()})};window.initBackgroundPage=S;var T=T||!1;T||S();})();
